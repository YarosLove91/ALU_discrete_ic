# Лабораторная работа № 3 - Исследование программного процессора biRISC-V

## Цели и задачи

## 1 Введение в стандарт RISC-V
[Содержание 1 главы](./birisc_v%20description/Chapter_1_RISC_V_Intriducing.md)

### 1.1 Принципиальные различия между вариантами ISA, основанные на разрядности и числе регистров
### 1.2 Принцип адресации и представления данных в RISC-V
### 1.3 Классификация и структура форматов инструкций
#### 1.3.1 Форматы инструкций
#### 1.3.2 Структурные компоненты команд: opcode, регистры, стандартные расширения
### 1.4 Инструкции целочисленной арифметики
### 1.5 Расширение регистров управления и статуса (CSR)
### 1.6 Расширение умножения и деления целых чисел
### 1.7 Расширение атомарных инструкций
### 1.8 Расширение для одинарной точности с плавающей запятой
### 1.9 Расширение двойной точности для чисел с плавающей запятой
### 1.10 Расширение для чисел с плавающей запятой четверной точности
### 1.11 Расширение для сжатых инструкций (16-битные опкоды)
### 1.12 Расширение для манипуляции битами
### 1.13 Инструкция отладки

## 2 Описание процессора biRISC-V
В данном разделе представлено краткое описание архитектуры и модулей RTL дизайна процессора biRISC-V

### 2.1 Описание и ключевые особенности процессора

[Содержание 2 главы](./birisc_v%20description/Chapter_2_Core_description.md)
Для дизайна процессора biRISC-V характерны следующие особенности:

- 32-разрядное процессорное ядро RISC-V ISA;
- Суперскалярная in-order микроархитектура с конфигурируемым 6/7-стадийным конвейером;
- Двухканальный (dual-issue) диспетчер инструкций;
- Поддержка целочисленных инструкций RISC-V (I), умножения и деления (M), а также расширения инструкций CSR (Z) (RV32IMZicsr);
- Гибридный предсказатель (bimodal/gshare) с настраиваемой глубиной целевого буфера ветвлений (BTB) и стека адреса возврата (RAS);
- 64-битная выборка инструкций, 32-битный доступ к данным;
- 2 x целочисленных ALU (операции: арифметические, сдвига и ветвления);
- 1 x блок хранения с загрузкой, 1 x внеконвейерный делитель;
- Выдача и выполнение до 2 независимых инструкций за цикл;
- Поддерживаются уровни привилегий пользователя, супервизора и машинного режима;
- Базовая поддержка модуля управления памятью (Memory Manage Unit - MMU) - возможность загрузки Linux с эмуляцией атомарных инструкции (RV-A);
- Реализованы базовая спецификация ISA v2.1 и привилегированная спецификация ISA v1.11;
- Верифицированный дизайн с помощью случайных последовательностей инструкций RISCV-DV от Google, используя косимуляцию с моделью ISA C++;
- Поддержка кэша инструкций/данных, интерфейсов шины AXI или тесно связанной памяти (TCM - памяти);
- Настраиваемое количество стадий конвейера, опции пересылки результатов и ресурсы предсказания ветвлений;
- Синтезируемый Verilog 2001, совместимый с Verilator и аппаратной реализации на FPGA;
- Производительность: Coremark: 4.1 CoreMark/МГц и Dhrystone: 1.9 DMIPS/MHz (Поддержка "legal compile options" для эталонных тестов / 337 инструкций на итерацию).

### 2.2 Архитектура (реализация) процессора

#### 2.2.1 Общие компоненты
##### 2.2.1.1 Ядро процессора
###### 2.2.1.1.1 frontend
###### 2.2.1.1.1.1 npc  
###### 2.2.1.1.1.2 decode  
###### 2.2.1.1.1.3 fetch  
###### 2.2.1.1.2 lsu  
###### 2.2.1.1.2.1 lsu_fifo  
###### 2.2.1.1.3 mmu  
###### 2.2.1.1.4 csr  
###### 2.2.1.1.4.1 biriscv_csr_regfile  
###### 2.2.1.1.5 multiplier  
###### 2.2.1.1.6 divider  
###### 2.2.1.1.7 issue  
###### 2.2.1.1.7.1 pipe_ctrl  
###### 2.2.1.1.7.1.1 trace_sim  
###### 2.2.1.1.7.2 regfile  
###### 2.2.1.1.7.2.1 xilinx_2r1w  
###### 2.2.1.1.7.3 trace_sim  
###### 2.2.1.1.8 exec  
###### 2.2.1.1.8.1 alu  
#### 2.2.2 Реализация с TCM памятью
##### 2.2.2.1 tcm_top
###### 2.2.2.1.1 dport_mux  
###### 2.2.2.1.2 tcm_mem  
###### 2.2.2.1.2.1 tcm_mem_pmem  
###### 2.2.2.1.2.2 tcm_mem_ram  
###### 2.2.2.1.3 dport_axi  
###### 2.2.2.1.3.1 dport_axi_fifo  
#### 2.2.3 Реализация с КЭШ памятью
##### 2.2.3.1 top
###### 2.2.3.1.1 dcache  
###### 2.2.3.1.1.1 dcache_if_pmem  
###### 2.2.3.1.1.1.1 dcache_if_pmem_fifo  
###### 2.2.3.1.1.2 dcache_pmem_mux  
###### 2.2.3.1.1.3 dcache_mux  
###### 2.2.3.1.1.4 dcache_core  
###### 2.2.3.1.1.4.1 dcache_core_data_ram  
###### 2.2.3.1.1.4.2 dcache_core_tag_ram  
###### 2.2.3.1.1.5 dcache_axi  
###### 2.2.3.1.1.5.1 dcache_axi_fifo  
###### 2.2.3.1.1.5.2 dcache_axi_axi  
###### 2.2.3.1.2 icache  
###### 2.2.3.1.2.1 icache_tag_ram  
###### 2.2.3.1.2.2 icache_data_ram 

## 3 Руководство по программированию
### 3.1 Настройка окружения
### 3.2 Запуск 
#### 3.2.1 Линковка
##### 3.2.1.1 Статическая линковка
##### 3.2.1.2 Динамическая линковка 
##### 3.2.1.3 Конфигурационные файлы линковщика (.ld)
##### 3.2.1.4 Простой пример `.ld` файла
##### 3.2.1.5 Что можно контролировать через `.ld`
##### 3.2.1.6 Когда `.ld` необходим?
##### 3.2.1.7 Проверка структуры

## 4 Интеграционные тесты
### 4.1 Обоснование необходимости интеграционных тестов
### 4.2 Виды интеграционных тестов и их основные отличия
#### 4.2.1 Тесты tb_top
##### 4.2.1.1 Файловая структура тестбренча
##### 4.2.1.2 Описание, ключевые компаненты и основной функционал файлов
##### 4.2.1.3 Алгоритм настройки окружения
##### 4.2.1.4 Проверка работоспособности тестбренча
#### 4.2.2 Тесты tb_tcm
##### 4.2.2.1 Файловая структура тестбренча
##### 4.2.2.2 Описание, ключевые компаненты и основной функционал файлов
##### 4.2.2.3 Алгоритм настройки окружения
##### 4.2.2.4 Проверка работоспособности тестбренча

## Приложение А - описание сигнальных линий модулей ядра biRISC-V

Содержание Appendix

### Входные и выходные порты модуля riscv_core
### Основные внутренние сигналы модуля riscv_core
### Входные и выходные порты подмодуля issue
### Основные внутренние сигналы модуля issue
### Входные и выходные порты подмодуля frontend
### Основные внутренние сигналы подмодуля frontend
### Входные и выходные порты подмодуля exec
### Основные внутренние сигналы подмодуля exec
### Входные и выходные порты подмодуля csr
### Основные внутренние сигналы подмодуля csr
### Входные и выходные порты подмодуля lsu
### Основные внутренние сигналы подмодуля lsu

В качестве примера рекомендуется посмотреть книгу "Цифровой синтез". Лабораторная работа - schoolMIPS / schoolRISCV. 
