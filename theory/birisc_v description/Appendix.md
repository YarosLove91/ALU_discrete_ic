Приложение А  
Входные и выходные порты, внутренние сигналы модуля __riscv_core__

Таблица 1 - Входные и выходные порты модуля riscv_core.    

| Сигнал                    | Направление | Размерность (биты) | Описание                                |
|---------------------------|-------------|--------------------|-----------------------------------------|
| **Тактирование и сброс**  |             |                    |                                         |
| clk_i                     | Вход        | 1                  | Тактовый сигнал                         |
| rst_i                     | Вход        | 1                  | Сигнал сброса                           |
| **Интерфейс памяти данных** |           |                    |                                         |
| mem_d_data_rd_i           | Вход        | 32                 | Данные чтения из памяти данных          |
| mem_d_accept_i            | Вход        | 1                  | Подтверждение приема запроса данных     |
| mem_d_ack_i               | Вход        | 1                  | Подтверждение выполнения запроса        |
| mem_d_error_i             | Вход        | 1                  | Ошибка доступа к данным                 |
| mem_d_resp_tag_i          | Вход        | 11                 | Тег ответа данных                       |
| mem_d_addr_o              | Выход       | 32                 | Адрес данных                            |
| mem_d_data_wr_o           | Выход       | 32                 | Данные для записи                       |
| mem_d_rd_o                | Выход       | 1                  | Сигнал чтения данных                    |
| mem_d_wr_o                | Выход       | 4                  | Сигналы записи данных (по байтам)       |
| **Интерфейс памяти инструкций** |       |                    |                                         |
| mem_i_inst_i              | Вход        | 64                 | Инструкции из памяти (2x32-битные)      |
| mem_i_accept_i            | Вход        | 1                  | Подтверждение приема запроса инструкций |
| mem_i_valid_i             | Вход        | 1                  | Действительные данные инструкций        |
| mem_i_error_i             | Вход        | 1                  | Ошибка доступа к инструкциям            |
| mem_i_rd_o                | Выход       | 1                  | Сигнал чтения инструкций                |
| mem_i_flush_o             | Выход       | 1                  | Сброс кэша инструкций                   |
| mem_i_invalidate_o        | Выход       | 1                  | Инвалидация кэша инструкций             |
| mem_i_pc_o                | Выход       | 32                 | Адрес инструкции                        |
| **Системные сигналы**     |             |                    |                                         |
| intr_i                    | Вход        | 1                  | Вход прерывания                         |
| reset_vector_i            | Вход        | 32                 | Вектор сброса                           |
| cpu_id_i                  | Вход        | 32                 | Идентификатор CPU                       |
| **Управление кэшем**      |             |                    |                                         |
| mem_d_cacheable_o         | Выход       | 1                  | Флаг кэшируемости                       |
| mem_d_req_tag_o           | Выход       | 11                 | Тег запроса данных                      |
| mem_d_invalidate_o        | Выход       | 1                  | Инвалидация кэша                        |
| mem_d_writeback_o         | Выход       | 1                  | Запись обратно                          |
| mem_d_flush_o             | Выход       | 1                  | Сброс кэша                              |


Таблица 2 - Основные внутренние сигналы модуля riscv_core.  

| Сигнал                    | Размерность | Описание                                |
|---------------------------|-------------|-----------------------------------------|
| mmu_ifetch_inst_w         | 64          | Выбранные инструкции от MMU             |
| fetch0_instr_w            | 32          | Инструкция 0-го потока                  |
| fetch1_instr_w            | 32          | Инструкция 1-го потока                  |
| opcode0_opcode_w          | 32          | Декодированная инструкция потока 0      |
| opcode1_opcode_w          | 32          | Декодированная инструкция потока 1      |
| writeback_exec0_value_w   | 32          | Результат выполнения ALU потока 0       |
| writeback_exec1_value_w   | 32          | Результат выполнения ALU потока 1       |
| branch_pc_w               | 32          | Адрес перехода                          | 
| mmu_satp_w                | 32          | Регистр управления MMU                  |

Таблица 3 - Входные и выходные порты подмодуля issue.    

| Сигнал                    | Направление | Размерность (биты) | Описание                                |
|---------------------------|-------------|--------------------|-----------------------------------------|
| **Тактирование и сброс**  |             |                    |                                         |
| clk_i                     | Вход        | 1                  | Тактовый сигнал                         |
| rst_i                     | Вход        | 1                  | Сигнал сброса (активный высокий уровень)|
| **Интерфейс выборки**     |             |                    |                                         |
| fetch0_valid_i            | Вход        | 1                  | Валидность инструкции 0                 |
| fetch0_instr_i            | Вход        | 32                 | Инструкция 0                            |
| fetch0_pc_i               | Вход        | 32                 | Адрес инструкции 0                      |
| fetch1_valid_i            | Вход        | 1                  | Валидность инструкции 1                 |
| fetch1_instr_i            | Вход        | 32                 | Инструкция 1                            |
| fetch1_pc_i               | Вход        | 32                 | Адрес инструкции 1                      |
| **Информация о ветвлениях** |           |                    |                                         |
| branch_exec0_request_i    | Вход        | 1                  | Запрос ветвления от потока 0            |
| branch_exec1_request_i    | Вход        | 1                  | Запрос ветвления от потока 1            |
| **Результаты выполнения** |             |                    |                                         |
| writeback_exec0_value_i   | Вход        | 32                 | Результат ALU потока 0                  |
| writeback_exec1_value_i   | Вход        | 32                 | Результат ALU потока 1                  |
| writeback_mem_value_i     | Вход        | 32                 | Результат LSU                           |
| writeback_mul_value_i     | Вход        | 32                 | Результат умножения                     |
| writeback_div_value_i     | Вход        | 32                 | Результат деления                       |
| **Управление выборкой**   |             |                    |                                         |
| fetch0_accept_o           | Выход       | 1                  | Подтверждение приема инструкции 0       |
| fetch1_accept_o           | Выход       | 1                  | Подтверждение приема инструкции 1       |
| **Интерфейс исполнительных устройств** | |                |                                         |
| exec0_opcode_valid_o      | Выход       | 1                  | Валидность инструкции для потока 0      |
| exec1_opcode_valid_o      | Выход       | 1                  | Валидность инструкции для потока 1      |
| lsu_opcode_valid_o        | Выход       | 1                  | Валидность инструкции для LSU           |
| **Декодированные инструкции** |         |                    |                                         |
| opcode0_opcode_o          | Выход       | 32                 | Декодированная инструкция потока 0      |
| opcode1_opcode_o          | Выход       | 32                 | Декодированная инструкция потока 1      |
| **Информация о регистрах** |            |                    |                                         |
| opcode0_rd_idx_o          | Выход       | 5                  | Индекс регистра назначения потока 0     |
| opcode0_ra_idx_o          | Выход       | 5                  | Индекс регистра источника A потока 0    |
| opcode0_rb_idx_o          | Выход       | 5                  | Индекс регистра источника B потока 0    |


Таблица 4 - Основные внутренние сигналы модуля issue.  

| Сигнал                    | Размерность | Описание                                      |
|---------------------------|-------------|-----------------------------------------------|
| **Управление конвейером** |             |                                               |
| pipe0_stall_raw_w         | 1           | Сигнал остановки потока 0                     |
| pipe1_stall_raw_w         | 1           | Сигнал остановки потока 1                     |
| **Регистровый файл**      |             |                                               |
| issue_a_ra_value_w        | 32          | Значение регистра A потока 0                  |
| issue_a_rb_value_w        | 32          | Значение регистра B потока 0                  |
| issue_b_ra_value_w        | 32          | Значение регистра A потока 1                  |
| issue_b_rb_value_w        | 32          | Значение регистра B потока 1                  |
| **Состояние выполнения**  |             |                                               |
| pipe0_load_e1_w           | 1           | Флаг операции загрузки в стадии E1 потока 0   |
| pipe0_mul_e1_w            | 1           | Флаг операции умножения в стадии E1 потока 0  |
| pipe1_load_e1_w           | 1           | Флаг операции загрузки в стадии E1 потока 1   |


Таблица 5 - Входные и выходные порты подмодуля frontend.    

| Сигнал                     | Направление | Размерность | Описание                                      |
|----------------------------|-------------|-------------|-----------------------------------------------|
| **Тактирование и сброс**   |             |             |                                               |
| `clk_i`                    | Вход        | 1 бит       | Тактовый сигнал                               |
| `rst_i`                    | Вход        | 1 бит       | Сигнал сброса                                 |
| **Интерфейс кеша инструкций** |          |             |                                               |
| `icache_accept_i`          | Вход        | 1 бит       | Подтверждение приема от кеша инструкций       |
| `icache_valid_i`           | Вход        | 1 бит       | Валидность данных от кеша                     |
| `icache_inst_i`            | Вход        | 64 бита     | Инструкции из кеша                            |
| `icache_rd_o`              | Выход       | 1 бит       | Запрос чтения кеша                            |
| `icache_pc_o`              | Выход       | 32 бита     | Адрес для чтения кеша                         |
| **Интерфейс выборки**      |             |             |                                               |
| `fetch0_accept_i`          | Вход        | 1 бит       | Готовность приемника для fetch0               |
| `fetch1_accept_i`          | Вход        | 1 бит       | Готовность приемника для fetch1               |
| `fetch0_valid_o`           | Выход       | 1 бит       | Валидность инструкции 0                       |
| `fetch0_instr_o`           | Выход       | 32 бита     | Инструкция 0                                  |
| `fetch1_valid_o`           | Выход       | 1 бит       | Валидность инструкции 1                       |
| `fetch1_instr_o`           | Выход       | 32 бита     | Инструкция 1                                  |
| **Управление ветвлениями** |             |             |                                               |
| `branch_request_i`         | Вход        | 1 бит       | Запрос на ветвление                           |
| `branch_pc_i`              | Вход        | 32 бита     | Адрес ветвления                               |
| `branch_info_is_taken_i`   | Вход        | 1 бит       | Признак взятого ветвления                     |
| `branch_info_source_i`     | Вход        | 32 бита     | Адрес источника ветвления                     |
| **Типы инструкций**        |             |             |                                               |
| `fetch0_instr_exec_o`      | Выход       | 1 бит       | Признак исполнительной инструкции (поток 0)   |
| `fetch0_instr_lsu_o`       | Выход       | 1 бит       | Признак load/store (поток 0)                  |
| `fetch1_instr_branch_o`    | Выход       | 1 бит       | Признак ветвления (поток 1)                   |
| `fetch1_instr_mul_o`       | Выход       | 1 бит       | Признак умножения (поток 1)                   |


Таблица 6 - Основные внутренние сигналы подмодуля frontend.  

| Сигнал                  | Размерность | Описание                                                                 |
|-------------------------|-------------|--------------------------------------------------------------------------|
| **Управление выборкой**                                                                 |
| `fetch_valid_w`         | 1 бит       | Валидность текущего набора инструкций в конвейере                        |
| `fetch_instr_w`         | 64 бита     | Сдвоенная инструкция (2x32 бита) из кеша                                 |
| `fetch_accept_w`        | 1 бит       | Готовность конвейера к приему новых инструкций                           |
| `fetch_pc_accept_w`     | 1 бит       | Подтверждение приема адреса блоком NPC                                   |
| **Прогнозирование переходов**                                                          |
| `next_pc_f_w`           | 32 бита     | Следующий PC от блока предсказания (NPC)                                 |
| `next_taken_f_w`        | 2 бита      | Прогноз направления ветвления (00-не взято, 01-взято и т.д.)             |
| `fetch_pred_branch_w`   | 2 бита      | Состояние предсказания для текущего PC                                   |
| **Обработка исключений**                                                               |
| `fetch_fault_fetch_w`   | 1 бит       | Флаг ошибки выборки инструкции                                           |
| `fetch_fault_page_w`    | 1 бит       | Флаг page fault при обращении к памяти                                   |
| **Адресация**                                                                          |
| `fetch_pc_w`            | 32 бита     | Текущий адрес инструкции в конвейере                                     |
| `fetch_pc_f_w`          | 32 бита     | Адрес следующей инструкции для NPC                                       |
| **Декодирование**                                                                      |
| `fetch_instr_w`         | 64 бита     | Сырые инструкции перед декодированием                                    |


Таблица 7 - Входные и выходные порты подмодуля exec.    

| Сигнал                     | Направление | Размерность | Описание                                      |
|----------------------------|-------------|-------------|-----------------------------------------------|
| **Тактирование и управление**                                                      |
| `clk_i`                    | input       | 1 бит       | Тактовый сигнал                               |
| `rst_i`                    | input       | 1 бит       | Асинхронный сброс (активный 1)                |
| `hold_i`                   | input       | 1 бит       | Сигнал остановки конвейера                     |
| **Интерфейс инструкций**                                                          |
| `opcode_valid_i`           | input       | 1 бит       | Валидность текущей инструкции                  |
| `opcode_opcode_i`          | input       | 32 бита     | Код исполняемой инструкции                     |
| `opcode_pc_i`              | input       | 32 бита     | Адрес инструкции (текущий PC)                  |
| `opcode_invalid_i`         | input       | 1 бит       | Флаг невалидной инструкции                     |
| **Интерфейс регистров**                                                          |
| `opcode_rd_idx_i`          | input       | 5 бит       | Индекс регистра назначения (rd)                |
| `opcode_ra_idx_i`          | input       | 5 бит       | Индекс первого операнда (rs1)                  |
| `opcode_rb_idx_i`          | input       | 5 бит       | Индекс второго операнда (rs2)                  |
| `opcode_ra_operand_i`      | input       | 32 бита     | Значение регистра rs1                          |
| `opcode_rb_operand_i`      | input       | 32 бита     | Значение регистра rs2                          |
| **Интерфейс ветвлений**                                                          |
| `branch_request_o`         | output      | 1 бит       | Факт наличия ветвления                         |
| `branch_is_taken_o`        | output      | 1 бит       | Ветвление выполняется                          |
| `branch_is_not_taken_o`    | output      | 1 бит       | Ветвление не выполняется                       |
| `branch_source_o`          | output      | 32 бита     | PC исходной инструкции ветвления               |
| `branch_is_call_o`         | output      | 1 бит       | Флаг вызова подпрограммы                       |
| `branch_is_ret_o`          | output      | 1 бит       | Флаг возврата из подпрограммы                  |
| `branch_is_jmp_o`          | output      | 1 бит       | Флаг безусловного перехода                     |
| `branch_pc_o`              | output      | 32 бита     | Целевой PC перехода                            |
| `branch_d_request_o`       | output      | 1 бит       | Запрос предсказания ветвления                  |
| `branch_d_pc_o`            | output      | 32 бита     | PC для предсказания ветвления                  |
| `branch_d_priv_o`          | output      | 2 бита      | Уровень привилегий (не используется)           |
| **Интерфейс записи результатов**                                                |
| `writeback_value_o`        | output      | 32 бита     | Результат выполнения для записи в регистровый файл |

Таблица 6 - Основные внутренние сигналы подмодуля exec.  

| Сигнал              | Размерность | Описание |
|---------------------|-------------|----------|
| `imm20_r`           | 32 бита     | Immediate U-типа |
| `imm12_r`           | 32 бита     | Immediate I-типа |
| `bimm_r`           | 32 бита     | Immediate B-типа |
| `jimm20_r`         | 32 бита     | Immediate J-типа |
| `shamt_r`          | 5 бит       | Величина сдвига |
| `alu_func_r`       | 4 бита      | Код операции ALU |
| `alu_input_a_r`    | 32 бита     | Первый операнд ALU |
| `alu_input_b_r`    | 32 бита     | Второй операнд ALU |
| `branch_r`         | 1 бит       | Внутренний флаг ветвления |
| `branch_taken_r`   | 1 бит       | Флаг взятия ветвления |
| `branch_target_r`  | 32 бита     | Целевой адрес ветвления |

Таблица 8 - Входные и выходные порты подмодуля csr.    

| Сигнал                             | Направление | Размерность | Описание                                      |
|------------------------------------|-------------|-------------|-----------------------------------------------|
| **Тактирование и управление**                                                      |
| `clk_i`                            | input       | 1 бит       | Тактовый сигнал                               |
| `rst_i`                            | input       | 1 бит       | Асинхронный сброс (активный высокий уровень)  |
| **Прерывания и исключения**                                                       |
| `intr_i`                           | input       | 1 бит       | Внешнее прерывание                            |
| `interrupt_inhibit_i`              | input       | 1 бит       | Запрет обработки прерываний                   |
| `take_interrupt_o`                 | output      | 1 бит       | Флаг обработки прерывания                     |
| **Интерфейс инструкций**                                                          |
| `opcode_valid_i`                   | input       | 1 бит       | Валидность текущей инструкции                 |
| `opcode_opcode_i`                  | input       | 32 бита     | Код инструкции                                |
| `opcode_pc_i`                      | input       | 32 бита     | Адрес инструкции                              |
| `opcode_invalid_i`                 | input       | 1 бит       | Флаг невалидной инструкции                    |
| `opcode_rd_idx_i`                  | input       | 5           | opcode_rd_idx_i                               |
| `opcode_ra_idx_i`                  | input       | 5           | Индекс первого операнда (rs1)                 |
| `opcode_rb_idx_i`                  | input       | 5           | Индекс второго операнда (rs2)                 |
| `opcode_ra_operand_i`              | input       | 32          | Первый операнд (rs1)                          |
| `opcode_rb_operand_i`              | input       | 32          | Второй операнд (rs2)                          |
| **Системные регистры (CSR)**                                                     |
| `csr_writeback_write_i`            | input       | 1 бит       | Запись в CSR                                  |
| `csr_writeback_waddr_i`            | input       | 12 бит      | Адрес CSR                                     |
| `csr_writeback_wdata_i`            | input       | 32 бита     | Данные для записи в CSR                       |
| `csr_result_e1_value_o`            | output      | 32 бита     | Прочитанное значение CSR                      |
| `csr_result_e1_write_o`            | output      | 1 бит       | Подтверждение записи в CSR                    |
| `csr_result_e1_wdata_o`            | output      | 32 бита     | Данные для записи в CSR                       |
| `csr_writeback_exception_i`        | input       | 6           | Код исключения                                |
| `csr_writeback_exception_pc_i`     | input       | 32          | Адрес инструкции, вызвавшей исключение        |
| `csr_writeback_exception_addr_i`   | input       | 32          | Адрес, связанный с исключением (например, для page fault)               |
| **Управление ветвлениями**                                                       |
| `branch_csr_request_o`             | output      | 1 бит       | Запрос ветвления по CSR                       |
| `branch_csr_pc_o`                  | output      | 32 бита     | Адрес ветвления по CSR                        |
| `branch_csr_priv_o`                | output      | 2 бита      | Уровень привилегий после ветвления            |
| **Управление памятью**                                                           |
| `ifence_o`                         | output      | 1 бит       | Сброс конвейера инструкций                    |
| `mmu_priv_d_o`                     | output      | 2 бита      | Уровень привилегий для MMU                    |
| `mmu_sum_o`                        | output      | 1 бит       | Разрешение доступа к пользовательской памяти  |
| `mmu_mxr_o`                        | output      | 1 бит       | Разрешение выполнения при чтении              |
| `mmu_flush_o`                      | output      | 1 бит       | Сброс TLB                                     |
| `mmu_satp_o`                       | output      | 32 бита     | Регистр трансляции адресов                    |
| **Идентификация и векторы**                                                      |
| `cpu_id_i`                         | input       | 32 бита     | Идентификатор процессора                      |
| `reset_vector_i`                   | input       | 32 бита     | Начальный адрес исполнения                    |
| **Исключения**                     |             |             |                                               |
| `csr_result_e1_exception_o`        | output      | 6           | Код исключения на стадии E1                   |

Таблица 6 - Основные внутренние сигналы подмодуля csr.  


| Категория               | Сигнал               | Тип    | Описание                                                                 |
|-------------------------|----------------------|--------|--------------------------------------------------------------------------|
| **Декодирование**       | `ecall_w`            | wire   | Флаг инструкции `ECALL` (вызов исключения)                               |
|                         | `ebreak_w`           | wire   | Флаг инструкции `EBREAK` (отладочное прерывание)                         |
|                         | `eret_w`             | wire   | Флаг инструкции `ERET` (возврат из исключения)                           |
|                         | `csrrw_w`            | wire   | Флаг инструкции `CSRRW` (чтение/запись CSR)                             |
|                         | `csrrs_w`            | wire   | Флаг инструкции `CSRRS` (установка битов CSR)                           |
| **Управление CSR**      | `current_priv_w`     | wire   | Текущий уровень привилегий (M/S/U)                                       |
|                         | `csr_priv_r`         | reg    | Требуемый уровень привилегий для доступа к CSR                           |
|                         | `csr_readonly_r`     | reg    | Флаг "только для чтения" CSR                                             |
|                         | `satp_update_w`      | wire   | Флаг обновления регистра `SATP` (виртуальная память)                     |
| **Исключения**          | `exception_e1_q`     | reg    | Код исключения на стадии E1                                              |
|                         | `eret_fault_w`       | wire   | Ошибка при `ERET` (недостаточные привилегии)                            |
| **Прерывания**          | `interrupt_w`        | wire   | Маска активных прерываний                                                |
|                         | `take_interrupt_q`   | reg    | Флаг разрешения обработки прерывания                                     |
| **MMU/TLB**            | `status_reg_w`       | wire   | Значение регистра `mstatus` (настройки MMU)                              |
|                         | `satp_reg_w`         | wire   | Значение регистра `satp` (таблица страниц)                               |
|                         | `tlb_flush_q`        | reg    | Флаг сброса TLB                                                          |
| **Переходы**           | `csr_branch_w`       | wire   | Запрос перехода (исключение/прерывание)                                 |
|                         | `csr_target_w`       | wire   | Адрес перехода (новый PC)                                               |
| **Системные**          | `misa_w`             | wire   | Регистр `misa` (поддерживаемые расширения CPU)                           |
|                         | `reset_q`            | reg    | Флаг начального сброса                                                  |